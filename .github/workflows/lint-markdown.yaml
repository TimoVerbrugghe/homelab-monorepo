name: Lint Markdown

on:
  push:
    branches:
      - master
    paths:
      - '**.md'
  pull_request:
    paths:
      - '**.md'
  workflow_dispatch:

jobs:
  markdown-lint:
    name: Lint Markdown files
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run markdownlint
        uses: DavidAnson/markdownlint-cli2-action@v16
        with:
          globs: |
            **/*.md
            !node_modules
            !.venv
            !result

      - name: Create markdownlint config if it doesn't exist
        if: failure()
        run: |
          if [ ! -f .markdownlint.json ]; then
            cat > .markdownlint.json << 'EOF'
          {
            "default": true,
            "MD013": {
              "line_length": 200,
              "heading_line_length": 120,
              "code_block_line_length": 200,
              "code_blocks": true,
              "tables": false,
              "headings": true,
              "strict": false,
              "stern": false
            },
            "MD033": {
              "allowed_elements": ["br", "img", "details", "summary"]
            },
            "MD041": false,
            "MD046": {
              "style": "fenced"
            },
            "no-hard-tabs": false
          }
          EOF
            echo "Created default .markdownlint.json config"
            echo "Re-run the workflow to apply the configuration"
          fi
