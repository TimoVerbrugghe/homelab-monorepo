apiVersion: batch/v1
kind: CronJob
metadata:
  name: bitwarden-export
  namespace: bitwarden
spec:
  schedule: "0 2 * * *" # Runs daily at 2:00 AM
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          nodeSelector:
            kubernetes.io/hostname: yumi
          containers:
            - name: bitwarden-export
              image: ghcr.io/timoverbrugghe/bitwarden-export:latest # Replace with your container image
              env:
                - name: BW_SERVER
                  value: http://bitwarden.bitwarden.svc.cluster.local
                - name: BW_APPID
                  valueFrom:
                    secretKeyRef:
                      name: bitwarden-export-secret
                      key: BW_APPID
                - name: BW_CLIENTID
                  valueFrom:
                    secretKeyRef:
                      name: bitwarden-export-secret
                      key: BW_CLIENTID
                - name: BW_CLIENTSECRET
                  valueFrom:
                    secretKeyRef:
                      name: bitwarden-export-secret
                      key: BW_CLIENTSECRET
                - name: BW_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: bitwarden-export-secret
                      key: BW_PASSWORD
              volumeMounts:
                - name: nfs-export
                  mountPath: /backup
          volumes:
            - name: nfs-export
              nfs:
                server: nfs.local.timo.be
                path: /mnt/FranzHopper/appdata/bitwarden-export
