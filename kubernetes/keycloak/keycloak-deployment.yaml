# Deploy keycloak using bitnami helm chart
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: keycloak
  namespace: kube-system
spec:
  chart: keycloak
  targetNamespace: keycloak
  repo: https://charts.bitnami.com/bitnami
  valuesContent: |-
    image:
      tag: latest
    auth:
      adminUser: admin
      adminPassword: admin
      tls:
        enabled: true
        autoGenerated: true
    proxy: passthrough
    replicaCount: 1
    service:
      type: ClusterIP
    postgresql:
      enabled: false
    externalDatabase:
      host: keycloak-cluster.keycloak.svc.cluster.local
      user: keycloak
      database: keycloak
      password: keycloak
    cache:
      enabled: true
    extraEnvVars:
      - name: KEYCLOAK_PRODUCTION
        value: "true"
      - name: KC_HOSTNAME
        value: "keycloaktest.timo.be"
    extraStartupArgs: "--import-realm"
    extraVolumes:
      - name: keycloak-local-storage
        persistentVolumeClaim:
          claimName: keycloak-local-storage-pvc
    extraVolumeMounts:
      - name: keycloak-local-storage
        mountPath: /opt/bitnami/keycloak/data/import