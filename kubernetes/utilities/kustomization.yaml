# Apply all these resources with `kubectl kustomize --enable-helm . | kubectl apply -f -` from the directory containing this file
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

secretGenerator:
  - name: adguardhome-sync-secrets
    namespace: cert-manager
    envs:
    - adguardhome/adguardhome-sync.env
    type: Opaque
    options:
      annotations:
        reflector.v1.k8s.emberstack.com/reflection-allowed: "true"
        reflector.v1.k8s.emberstack.com/reflection-auto-enabled: "true"
        reflector.v1.k8s.emberstack.com/reflection-auto-namespaces: "utilities"

configMapGenerator:
  - name: homepage
    namespace: utilities
    files:
      - settings.yaml=homepage/settings.yaml
      - bookmarks.yaml=homepage/bookmarks.yaml
      - widgets.yaml=homepage/widgets.yaml
      - kubernetes.yaml=homepage/kubernetes.yaml
      - services.yaml=homepage/services.yaml
      - docker.yaml=homepage/docker.yaml
    options:
      labels:
        app.kubernetes.io/name: homepage

generatorOptions:
 disableNameSuffixHash: true

resources:
  - namespace.yaml

  # Stirling-PDF
  - stirling-pdf/stirling-pdf.yaml
  - stirling-pdf/stirling-pdf-service.yaml
  - stirling-pdf/stirling-pdf-ingress.yaml

  # Webtop
  - webtop/webtop.yaml
  - webtop/webtop-service.yaml
  - webtop/webtop-ingress.yaml
  - webtop/webtop-clusterrolebinding.yaml
  
  - adguardhome/adguardhome-sync.yaml

  # Keel
  - keel/keel-clusterrolebinding.yaml
  - keel/keel-ingress.yaml

  # Homepage - Based on installation instructions here https://gethomepage.dev/installation/k8s/
  - homepage/homepage-serviceaccount.yaml
  - homepage/homepage.yaml
  - homepage/homepage-ingress.yaml
  - homepage/homepage-clusterrolebinding.yaml
  - homepage/homepage-service.yaml
  - homepage/homepage-secret.yaml

helmCharts:
  - name: keel
    repo: https://keel-hq.github.io/keel/
    releaseName: keel
    namespace: utilities
    valuesFile: keel/keel-values.yaml