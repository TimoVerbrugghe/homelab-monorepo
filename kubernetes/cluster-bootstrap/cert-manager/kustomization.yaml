# Apply all these resources with `kubectl kustomize --enable-helm . | kubectl apply -f -` from the directory containing this file
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

generatorOptions:
 disableNameSuffixHash: true

secretGenerator:
  - name: cloudflare-token-secret
    namespace: cert-manager
    envs:
    - cloudflaretoken.env
    type: Opaque
    options:
      annotations:
        reflector.v1.k8s.emberstack.com/reflection-allowed: "true"
        reflector.v1.k8s.emberstack.com/reflection-auto-enabled: "true"
        reflector.v1.k8s.emberstack.com/reflection-auto-namespaces: "cert-manager, traefik"

resources:
  - https://github.com/cert-manager/cert-manager/releases/latest/download/cert-manager.yaml
  - cert-manager-namespace.yaml

patches:
  - target:
      kind: Deployment
      name: cert-manager
    path: cert-manager-patch.yaml
  - target:
      kind: Deployment
      name: cert-manager-webhook
    path: cert-manager-webhook-patch.yaml
  - target:
      kind: Deployment
      name: cert-manager-cainjector
    path: cert-manager-cainjector-patch.yaml