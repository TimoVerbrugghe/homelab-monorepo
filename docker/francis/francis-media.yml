### ADD FOLLOWING FILE TO PORTAINER WITH THESE ENVIRONMENT VARIABLES
# PUID=1000
# PGID=1000
# TS_AUTH_KEY_QBITTORRENT=
# TS_AUTH_KEY_PROWLARR=
# TS_AUTH_KEY_OVERSEERR=
# TS_AUTH_KEY_BAZARR=
# TS_AUTH_KEY_RADARR=
# TS_AUTH_KEY_SONARR=
# PLEX_TOKEN=
# PLEX_CLAIM_TOKEN=
# TS_AUTH_KEY_PLEX=

version: "3.8"

services:

  ### MEDIA PLAYBACK ###
  ### PLEX - PLAYING MEDIA
  tailscale-plex:
    image: tailscale/tailscale
    container_name: tailscale-plex
    hostname: plex
    restart: always
    volumes:
      - /dev/net/tun:/dev/net/tun
      - tailscale-plex:/var/lib/tailscale
    cap_add:
      - net_admin
      - sys_module
    environment:
      - TS_AUTH_KEY=${TS_AUTH_KEY_PLEX}
      - TS_STATE_DIR=/var/lib/tailscale/state
    ports:
      - 32400:32400/tcp

  plex:
    container_name: plex
    image: plexinc/pms-docker
    restart: always
    network_mode: service:tailscale-plex
    environment:
      PLEX_UID: ${PUID}
      PLEX_GID: ${PGID}
      TZ: Europe/Brussels
      PLEX_CLAIM: ${PLEX_CLAIM_TOKEN}
    volumes:
      - movies:/movies:rw
      - tvshows:/tv:rw
      - plex:/config:rw
      - /dev/shm:/dev/shm
    devices:
      - /dev/dri:/dev/dri

  plex-autolanguages:
    container_name: plex-autolanguagues
    image: remirigal/plex-auto-languages:latest
    restart: always
    environment:
      - PLEX_URL=http://plex:32400
      - PLEX_TOKEN=${PLEX_TOKEN}
      - TZ=Europe/Brussels

  ### MEDIA MANAGEMENT ###
  ### SONARR - MANAGING TVSHOWS
  tailscale-sonarr:
    image: tailscale/tailscale
    container_name: tailscale-sonarr
    hostname: sonarr
    restart: always
    volumes:
      - /dev/net/tun:/dev/net/tun
      - tailscale-sonarr:/var/lib/tailscale
    cap_add:
      - net_admin
      - sys_module
    environment:
      - TS_AUTH_KEY=${TS_AUTH_KEY_SONARR}
      - TS_STATE_DIR=/var/lib/tailscale/state

  sonarr:
    container_name: sonarr
    image: lscr.io/linuxserver/sonarr:latest
    restart: always
    network_mode: service:tailscale-sonarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - sonarr:/config

  ### RADARR - MANAGING MOVIES
  tailscale-radarr:
    image: tailscale/tailscale
    container_name: tailscale-radarr
    hostname: radarr
    restart: always
    volumes:
      - /dev/net/tun:/dev/net/tun
      - tailscale-radarr:/var/lib/tailscale
    cap_add:
      - net_admin
      - sys_module
    environment:
      - TS_AUTH_KEY=${TS_AUTH_KEY_RADARR}
      - TS_STATE_DIR=/var/lib/tailscale/state

  radarr:
    container_name: radarr
    image: lscr.io/linuxserver/radarr:latest
    restart: always
    network_mode: service:tailscale-radarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - radarr:/config
      - movies:/movies
      - downloads:/downloads

  ### BAZARR - MANAGING SUBTITLES
  tailscale-bazarr:
    image: tailscale/tailscale
    container_name: tailscale-bazarr
    hostname: bazarr
    restart: always
    volumes:
      - /dev/net/tun:/dev/net/tun
      - tailscale-bazarr:/var/lib/tailscale
    cap_add:
      - net_admin
      - sys_module
    environment:
      - TS_AUTH_KEY=${TS_AUTH_KEY_BAZARR}
      - TS_STATE_DIR=/var/lib/tailscale/state

  bazarr:
    container_name: bazarr
    image: lscr.io/linuxserver/bazarr:latest
    restart: always
    network_mode: service:tailscale-bazarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - bazarr:/config
      - movies:/movies
      - tvshows:/tv

  ### MEDIA REQUEST MANAGEMENT ###
  ### OVERSEERR - MANAGING REQUESTS
  tailscale-overseerr:
    image: tailscale/tailscale
    container_name: tailscale-overseerr
    hostname: overseerr
    restart: always
    volumes:
      - /dev/net/tun:/dev/net/tun
      - tailscale-overseerr:/var/lib/tailscale
    cap_add:
      - net_admin
      - sys_module
    environment:
      - TS_AUTH_KEY=${TS_AUTH_KEY_OVERSEERR}
      - TS_STATE_DIR=/var/lib/tailscale/state

  overseerr:
    container_name: overseerr
    image: sctx/overseerr:latest
    restart: always
    network_mode: service:tailscale-overseerr
    environment:
      - LOG_LEVEL=debug
      - TZ=Europe/Brussels
    volumes:
      - overseerr:/app/config
      
  ### DOWNLOAD MANAGEMENT ###
  ### PROWLARR - MANAGING TORRENT SITES
  tailscale-prowlarr:
    image: tailscale/tailscale
    container_name: tailscale-prowlarr
    hostname: prowlarr
    restart: always
    volumes:
      - /dev/net/tun:/dev/net/tun
      - tailscale-prowlarr:/var/lib/tailscale
    cap_add:
      - net_admin
      - sys_module
    environment:
      - TS_AUTH_KEY=${TS_AUTH_KEY_PROWLARR}
      - TS_STATE_DIR=/var/lib/tailscale/state

  prowlarr:
    container_name: prowlarr
    image: lscr.io/linuxserver/prowlarr:latest
    restart: always
    network_mode: service:tailscale-prowlarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - prowlarr:/config
  
  ### QBITTORRENT - MANAGING DOWNLOADS
  tailscale-qbittorrent:
    image: tailscale/tailscale
    container_name: tailscale-qbittorrent
    hostname: qbittorrent
    restart: always
    volumes:
      - /dev/net/tun:/dev/net/tun
      - tailscale-qbittorrent:/var/lib/tailscale
    cap_add:
      - net_admin
      - sys_module
    environment:
      - TS_AUTH_KEY=${TS_AUTH_KEY_QBITTORRENT}
      - TS_STATE_DIR=/var/lib/tailscale/state

  qbittorrent: 
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    restart: always
    network_mode: service:tailscale-qbittorrent
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
      - DOCKER_MODS=ghcr.io/gabe565/linuxserver-mod-vuetorrent
    volumes:
      - qbittorrent:/config
      - downloads:/downloads

volumes:
  tailscale-sonarr:
  sonarr:
  tailscale-plex:
  plex:
  tailscale-bazarr:
  bazarr:
  tailscale-radarr:
  radarr:
  tailscale-overseerr:
  overseerr:
  tailscale-prowlarr:
  prowlarr:
  tailscale-qbittorrent:
  qbittorrent:

  movies:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: '/home/odd/movies'
  tvshows:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: '/home/odd/tvshows'
  downloads:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: '/home/odd/downloads'