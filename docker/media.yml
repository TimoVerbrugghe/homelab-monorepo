version: "3.8"

services:
  plex-with-gpu:
    container_name: plex-with-gpu
    image: plexinc/pms-docker
    restart: unless-stopped
    network_mode: dockerproxy
    runtime: nvidia
    environment:
      - TZ=Europe/Brussels
      - NVIDIA_VISIBLE_DEVICES=GPU-7ae0af11-474c-3823-3f17-5de32da6a0b6
    ports:
      - 32400:32400/tcp
      - 32410:32410/udp
      - 32412:32412/udp
      - 32413:32413/udp
      - 32414:32414/udp
    volumes:
      - movies:/movies:rw
      - tvshows:/tv:rw
      - /tmp:/transcode:rw
      - /mnt/user/appdata/plex:/config:rw
    labels:
      - traefik.http.routers.plex.rule=Host(`plex.timo.be`)
      - traefik.http.routers.plex.entrypoints=https
      - traefik.http.services.plex.loadbalancer.server.port=32400

  jellyfin:
    container_name: jellyfin
    image: jellyfin/jellyfin
    network_mode: dockerproxy
    restart: unless-stopped
    runtime: nvidia
    user: 99:100
    environment:
      - TZ=Europe/Brussels
      - NVIDIA_VISIBLE_DEVICES=GPU-7ae0af11-474c-3823-3f17-5de32da6a0b6
    volumes:
      - /mnt/user/appdata/jellyfin:/config
      - /tmp:/cache
      - movies:/movies
      - tvshows:/tv
    labels:
      - traefik.http.routers.plex.rule=Host(`jellyfin.timo.be`)
      - traefik.http.routers.plex.entrypoints=https
      - traefik.http.services.plex.loadbalancer.server.port=8096

  sonarr:
    container_name: sonarr
    image: lscr.io/linuxserver/sonarr:latest
    restart: unless-stopped
    network_mode: dockerproxy
    environment:
      - PUID=99
      - PGID=100
      - TZ=Europe/Brussels
    volumes:
      - /mnt/user/appdata/sonarr:/config
      - tvshows:/tv
      - downloads:/downloads
    labels:
      - traefik.http.routers.sonarr.entrypoints=https
      - traefik.http.services.sonarr.loadbalancer.server.port=8989
      - traefik.http.routers.sonarr.middlewares=keycloak-auth@file

  radarr:
    container_name: radarr
    image: lscr.io/linuxserver/radarr:latest
    restart: unless-stopped
    network_mode: dockerproxy
    environment:
      - PUID=99
      - PGID=100
      - TZ=Europe/Brussels
    volumes:
      - /mnt/user/appdata/radarr:/config
      - movies:/movies
      - downloads:/downloads
    labels:
      - traefik.http.routers.radarr.entrypoints=https
      - traefik.http.services.radarr.loadbalancer.server.port=7878
      - traefik.http.routers.radarr.middlewares=keycloak-auth@file

  lidarr:
    container_name: lidarr
    image: lscr.io/linuxserver/lidarr:latest
    restart: unless-stopped
    network_mode: dockerproxy
    environment:
      - PUID=99
      - PGID=100
      - TZ=Europe/Brussels
    volumes:
      - /mnt/user/appdata/lidarr:/config
      - music:/music
      - downloads:/downloads
    labels:
      - traefik.http.routers.lidarr.entrypoints=https
      - traefik.http.services.lidarr.loadbalancer.server.port=8686
      - traefik.http.routers.lidarr.middlewares=keycloak-auth@file

  bazarr:
    container_name: bazarr
    image: lscr.io/linuxserver/bazarr:latest
    restart: unless-stopped
    network_mode: dockerproxy
    environment:
      - PUID=99
      - PGID=100
      - TZ=Europe/Brussels
    volumes:
      - /mnt/user/appdata/bazarr:/config
      - movies:/movies
      - tvshows:/tv
    labels:
      - traefik.http.routers.bazarr.entrypoints=https
      - traefik.http.services.bazarr.loadbalancer.server.port=6767
      - traefik.http.routers.bazarr.middlewares=keycloak-auth@file

  overseerr:
    container_name: overseerr
    image: sctx/overseerr:latest
    restart: unless-stopped
    network_mode: dockerproxy
    environment:
      - LOG_LEVEL=debug
      - TZ=Europe/Brussels
    volumes:
      - /mnt/user/appdata/overseerr:/app/config
    labels:
      - traefik.http.routers.plex.rule=Host(`request.timo.be`)
      - traefik.http.routers.overseerr.entrypoints=https
      - traefik.http.services.overseerr.loadbalancer.server.port=5055
      - traefik.http.routers.overseerr.middlewares=keycloak-auth@file

  prowlarr:
    container_name: prowlarr
    image: lscr.io/linuxserver/prowlarr:latest
    restart: unless-stopped
    network_mode: dockerproxy
    environment:
      - PUID=99
      - PGID=100
      - TZ=Europe/Brussels
    volumes:
      - /mnt/user/appdata/prowlarr:/config
    labels:
      - traefik.http.routers.prowlarr.entrypoints=https
      - traefik.http.services.prowlarr.loadbalancer.server.port=9696
      - traefik.http.routers.prowlarr.middlewares=keycloak-auth@file

  tautulli:
    image: ghcr.io/tautulli/tautulli
    container_name: tautulli
    restart: unless-stopped
    network_mode: dockerproxy
    environment:
      - PUID=99
      - PGID=100
      - TZ=Europe/Brussels
    volumes:
      - /mnt/user/appdata/tautulli:/config
    labels:
      - traefik.http.routers.tautulli.entrypoints=https
      - traefik.http.services.tautulli.loadbalancer.server.port=8181
      - traefik.http.routers.tautulli.middlewares=keycloak-auth@file

  emulatorjs:
    image: lscr.io/linuxserver/emulatorjs:latest
    container_name: emulatorjs
    restart: unless-stopped
    environment:
      - PUID=99
      - PGID=100
      - TZ=Europe/Brussels
    volumes:
      - /mnt/user/appdata/emulatorjs:/config
      - /mnt/user/appdata/emulatorjs-data:/data
      - /mnt/user/games/DS:/data/nds/roms:rw
      - /mnt/user/games/GBA:/data/gba/roms:rw
      - /mnt/user/games/GBC:/data/gbc/roms:rw
      - /mnt/user/games/PS1:/data/psx/roms:rw
      - /mnt/user/games/SNES:/data/snes/roms:rw
    labels:
      - traefik.http.routers.emulatorjs.rule=Host(`games.timo.be`)
      - traefik.http.routers.emulatorjs.entrypoints=https
      - traefik.http.services.emulatorjs.loadbalancer.server.port=80
      - traefik.http.routers.emulatorjs.middlewares=keycloak-auth@file
      - traefik.http.routers.emulatorjs-config.rule=Host(`gamesconfig.timo.be`)
      - traefik.http.routers.emulatorjs-config.entrypoints=https
      - traefik.http.services.emulatorjs-config.loadbalancer.server.port=3000
      - traefik.http.routers.emulatorjs-config.middlewares=keycloak-auth@file

volumes:
  movies:
    external: true
  downloads:
    external: true
  music:
    external: true
  tvshows:
    external: true
  dsgames:
    external: true
  gbagames:
    external: true
  gbcgames:
    external: true
  ps1games:
    external: true
  snesgames:
    external: true
