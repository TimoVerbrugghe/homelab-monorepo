version: "3.8"

services:
  jellyfin:
    container_name: jellyfin
    image: jellyfin/jellyfin
    restart: unless-stopped
    environment:
      - TZ=Europe/Brussels
    volumes:
      - jellyfin:/config
      - /tmp:/cache
      - movies:/movies
      - tvshows:/tv
      - /dev/shm:/dev/shm
    devices:
      - /dev/dri:/dev/dri
    labels:
      - traefik.http.routers.jellyfin.entrypoints=https
      - traefik.http.services.jellyfin.loadbalancer.server.port=8096

  plex:
    container_name: plex
    image: plexinc/pms-docker
    restart: unless-stopped
    environment:
      - TZ=Europe/Brussels
      - PLEX_CLAIM=${PLEX_CLAIM_TOKEN}
    ports:
      - 32400:32400/tcp
      - 32410:32410/udp
      - 32412:32412/udp
      - 32413:32413/udp
      - 32414:32414/udp
    volumes:
      - movies:/movies:rw
      - tvshows:/tv:rw
      - /tmp:/transcode:rw
      - plex:/config:rw
      - /dev/shm:/dev/shm
    devices:
      - /dev/dri:/dev/dri
    labels:
      - traefik.http.routers.plex.entrypoints=https
      - traefik.http.services.plex.loadbalancer.server.port=32400

  plex-autolanguages:
    container_name: plex-autolanguagues
    image: remirigal/plex-auto-languages:latest
    networks:
      - dockerproxy
    restart: unless-stopped
    environment:
      - PLEX_URL=http://plex:32400
      - PLEX_TOKEN=${PLEX_TOKEN}
      - TZ=Europe/Brussels
    labels:
      - traefik.enable=false

  sonarr:
    container_name: sonarr
    image: lscr.io/linuxserver/sonarr:latest
    restart: unless-stopped
    networks:
      - dockerproxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - sonarr:/config
      - tvshows:/tv
      - downloads:/downloads
    labels:
      - traefik.http.routers.sonarr.entrypoints=https
      - traefik.http.services.sonarr.loadbalancer.server.port=8989
      - traefik.http.routers.sonarr.middlewares=keycloak-auth@file

  radarr:
    container_name: radarr
    image: lscr.io/linuxserver/radarr:latest
    restart: unless-stopped
    networks:
      - dockerproxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - radarr:/config
      - movies:/movies
      - downloads:/downloads
    labels:
      - traefik.http.routers.radarr.entrypoints=https
      - traefik.http.services.radarr.loadbalancer.server.port=7878
      - traefik.http.routers.radarr.middlewares=keycloak-auth@file

  lidarr:
    container_name: lidarr
    image: lscr.io/linuxserver/lidarr:latest
    restart: unless-stopped
    networks:
      - dockerproxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - lidarr:/config
      - music:/music
      - downloads:/downloads
    labels:
      - traefik.http.routers.lidarr.entrypoints=https
      - traefik.http.services.lidarr.loadbalancer.server.port=8686
      - traefik.http.routers.lidarr.middlewares=keycloak-auth@file

  bazarr:
    container_name: bazarr
    image: lscr.io/linuxserver/bazarr:latest
    restart: unless-stopped
    networks:
      - dockerproxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - bazarr:/config
      - movies:/movies
      - tvshows:/tv
    labels:
      - traefik.http.routers.bazarr.entrypoints=https
      - traefik.http.services.bazarr.loadbalancer.server.port=6767
      - traefik.http.routers.bazarr.middlewares=keycloak-auth@file

  overseerr:
    container_name: overseerr
    image: sctx/overseerr:latest
    restart: unless-stopped
    networks:
      - dockerproxy
    environment:
      - LOG_LEVEL=debug
      - TZ=Europe/Brussels
    volumes:
      - overseerr:/app/config
    labels:
      - traefik.http.routers.overseerr.rule=Host(`request.home.timo.be`)
      - traefik.http.routers.overseerr.entrypoints=https
      - traefik.http.services.overseerr.loadbalancer.server.port=5055
      - traefik.http.routers.overseerr.middlewares=keycloak-auth@file

  prowlarr:
    container_name: prowlarr
    image: lscr.io/linuxserver/prowlarr:latest
    restart: unless-stopped
    networks:
      - dockerproxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - prowlarr:/config
    labels:
      - traefik.http.routers.prowlarr.entrypoints=https
      - traefik.http.services.prowlarr.loadbalancer.server.port=9696
      - traefik.http.routers.prowlarr.middlewares=keycloak-auth@file

  tautulli:
    image: ghcr.io/tautulli/tautulli
    container_name: tautulli
    restart: unless-stopped
    networks:
      - dockerproxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - tautulli:/config
    labels:
      - traefik.http.routers.tautulli.entrypoints=https
      - traefik.http.services.tautulli.loadbalancer.server.port=8181
      - traefik.http.routers.tautulli.middlewares=keycloak-auth@file

  emulatorjs:
    image: lscr.io/linuxserver/emulatorjs:latest
    container_name: emulatorjs
    restart: unless-stopped
    networks:
      - dockerproxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
    volumes:
      - emulatorjs:/config
      - emulatorjs-data:/data
      - dsgames:/data/nds/roms:rw
      - gbagames:/data/gba/roms:rw
      - gbcgames:/data/gbc/roms:rw
      - ps1games:/data/psx/roms:rw
      - snesgames:/data/snes/roms:rw
    labels:
      - traefik.http.routers.emulatorjs.rule=Host(`games.home.timo.be`)
      - traefik.http.routers.emulatorjs.entrypoints=https
      - traefik.http.services.emulatorjs.loadbalancer.server.port=80
      - traefik.http.routers.emulatorjs.middlewares=keycloak-auth@file
      - traefik.http.routers.emulatorjs-config.rule=Host(`gamesconfig.home.timo.be`)
      - traefik.http.routers.emulatorjs-config.entrypoints=https
      - traefik.http.services.emulatorjs-config.loadbalancer.server.port=3000
      - traefik.http.routers.emulatorjs-config.middlewares=keycloak-auth@file

volumes:
  downloads:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/user/downloads"
  movies:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/user/movies"
  tvshows:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/user/tvshows"
  music:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/user/music"
  dsgames:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/user/games/DS"
  gbagames:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/user/games/GBA"
  ps1games:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/user/games/PS1"
  snesgames:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/user/games/SNES"
  gbcgames:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/user/games/GBC"

  sonarr:
  radarr:
  lidarr:
  bazarr:
  overseerr:
  prowlarr:
  tautulli:
  emulatorjs:
  emulatorjs-data:
  jellyfin:
  plex:

networks:
  dockerproxy:
    external: true
