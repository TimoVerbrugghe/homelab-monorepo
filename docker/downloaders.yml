version: "3.8"

services:
  qbittorrent: 
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    restart: always
    networks: 
      - dockerproxy
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Brussels
      - DOCKER_MODS=ghcr.io/gabe565/linuxserver-mod-vuetorrent
    volumes:
      - qbittorrent:/config
      - downloads:/downloads
    labels:
      traefik.http.routers.qbittorrent.entrypoints: https
      traefik.http.services.qbittorrent.loadbalancer.server.port: 8080
      traefik.http.routers.qbittorrent.middlewares: keycloak-auth@file

  # icloudpd-timo:
  #   image: boredazfcuk/icloudpd
  #   container_name: icloudpd-timo
  #   restart: always
    # networks: 
    #   - dockerproxy
  #   environment:
  #     - apple_id={$ICLOUDPD_APPLE_ID}
  #     - authentication_type=MFA

  #     - synchronisation_interval=86400
  #     - TZ=Europe/London
  #     - download_path=/home/user/iCloud
  #     - skip_check=true
  #     - auto_delete=true
  #     - UMASK=000
      #   - PUID=${PUID}
      # - PGID=${PGID}
  #     - notification_type=Webhook
  #     - notification_title=iCloudPD
  #     - webhook_server=hooks.slack.com
  #     - webhook_port=443
  #     - webhook_path=/services/
  #     - webhook_id={$ICLOUDPD_WEBHOOK_ID}
  #     - webhook_body=text
  #     - webhook_https=true
  #   volumes:
  #       - icloudpd-timo:/config
  #       - icloudpd-data:/home/user/iCloud
  #   labels:
  #     traefik.enable: false

  jdownloader2:
    image: jlesage/jdownloader-2
    container_name: jdownloader2
    restart: always
    networks: 
      - dockerproxy
    volumes:
      - jdownloader2:/config
      - downloads:/output
    labels:
      traefik.http.routers.jdownloader.rule: Host(`jdownloader.home.timo.be`) || Host(`jdownloader.timo.be`)
      traefik.http.routers.jdownloader.entrypoints: https
      traefik.http.services.jdownloader.loadbalancer.server.port: 5800
      traefik.http.routers.jdownloader.middlewares: keycloak-auth@file
    
  aria2-pro:
    image: p3terx/aria2-pro
    container_name: aria2-pro
    restart: always
    networks: 
      - dockerproxy
    logging:
      options:
        max-size: 1m
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - UMASK_SET=022
      - RPC_SECRET={$ARIA2_RPC_SECRET}
      - RPC_PORT=6800
      - LISTEN_PORT=6888
    volumes:
      - aria2-pro:/config
      - downloads:/downloads
    labels:
      traefik.http.routers.aria2pro.entrypoints: https
      traefik.http.services.aria2pro.loadbalancer.server.port: 6800

  ariang:
    image: p3terx/ariang
    container_name: ariang
    restart: always
    networks:
      - dockerproxy
    logging:
      options:
        max-size: 1m
    labels:
      traefik.http.routers.ariang.entrypoints: https
      traefik.http.services.ariang.loadbalancer.server.port: 6880
      traefik.http.routers.ariang.middlewares: keycloak-auth@file    

  metube:
    image: ghcr.io/alexta69/metube
    container_name: metube
    restart: always
    networks:
      - dockerproxy
    environment:
      - TEMP_DIR=/tmp
      - DARK_MODE=true
    volumes:
      - downloads:/downloads
      - /tmp:/tmp
    labels:
      traefik.http.routers.metube.entrypoints: https
      traefik.http.services.metube.loadbalancer.server.port: 8081
      traefik.http.routers.metube.middlewares: keycloak-auth@file 

volumes:
  # icloudpd-timo:
  qbittorrent:
  flood:
  jdownloader2:
  aria2-pro:
  downloads:
    driver_opts:
      type: "nfs"
      o: "addr=nfs.home.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/FranzHopper/downloads"
  
networks:
  dockerproxy:
    external: true