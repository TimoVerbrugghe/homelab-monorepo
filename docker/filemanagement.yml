version: "3.8"

services:
  filebrowser:
    container_name: filebrowser
    image: filebrowser/filebrowser
    restart: always
    environment:
      - FB_DATABASE=/config/database.db
      - FB_CONFIG=/config/filebrowser.json
      - FB_NOAUTH=true
    networks:
      - dockerproxy
    volumes:
      - media:/srv/media
      - isos:/srv/isos
      - downloads:/srv/downloads
      - filebrowser:/config
    labels:
      traefik.http.routers.filebrowser.entrypoints: https
      traefik.http.services.filebrowser.loadbalancer.server.port: 80
      traefik.http.routers.filebrowser.middlewares: keycloak-auth@file
      traefik.http.routers.filebrowser.rule: Host(`files.home.timo.be`) || Host(`files.timo.be`)

  filezilla:
    image: lscr.io/linuxserver/filezilla:latest
    container_name: filezilla
    restart: always
    networks:
      - dockerproxy
    environment:
      - TZ=Europe/Brussels
    volumes:
      - filezilla:/config
      - media:/media
      - isos:/isos
      - downloads:/downloads
    labels:
      traefik.http.routers.filezilla.entrypoints: https
      traefik.http.services.filezilla.loadbalancer.server.port: 3000
      traefik.http.routers.filezilla.middlewares: keycloak-auth@file

  krusader:
    container_name: krusader
    image: binhex/arch-krusader
    restart: always
    privileged: true
    networks:
      - dockerproxy
    environment:
      - TEMP_FOLDER=/config/krusader/tmp
      - WEBPAGE_TITLE=krusader
      - PUID=${PUID}
      - PGID=${PGID}
    volumes:
      - media:/media
      - isos:/isos
      - downloads:/downloads
      - krusader:/config
    labels:
      traefik.http.routers.krusader.entrypoints: https
      traefik.http.services.krusader.loadbalancer.server.port: 6080
      traefik.http.routers.krusader.middlewares: keycloak-auth@file

volumes:
  filebrowser:
  media:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/X.A.N.A./media"
  isos:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/FranzHopper/isos"
  downloads:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=nfs.local.timo.be,nolock,rw,vers=4.2,relatime,sec=sys,hard"
      device: ":/mnt/FranzHopper/downloads"
  filezilla:
  krusader:

networks:
  dockerproxy:
    external: true

