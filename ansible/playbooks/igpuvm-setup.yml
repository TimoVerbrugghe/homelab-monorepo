- name: Do first time Ubuntu setup
  hosts: igpuvm
  gather_facts: true
  become: true
  roles:
    - role: ../roles/ubuntu-vm-first-setup

- name: Install intel drivers
  hosts: igpuvm
  gather_facts: true
  become: true
  tasks:
    - ansible.builtin.include_tasks: ../tasks/install-intel-driver.yml

- name: Setup iGPU passthrough for igpuvm VM
  hosts: proxmox
  gather_facts: true
  tasks:
    - ansible.builtin.include_tasks: ../tasks/proxmox-vm-igpupassthrough.yml
      when: inventory_hostname == igpu_vm_proxmox_node

- name: Install Portainer Server & Get certs for DNS
  hosts: igpuvm
  gather_facts: true
  become: true
  roles:
    - role: ../roles/portainerserver-install
    - role: ../roles/certbot-renewal