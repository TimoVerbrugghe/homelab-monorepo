# - name: Update apt cache
#   ansible.builtin.apt:
#     update_cache: yes

- name: Setup automatic upgrades
  ansible.builtin.include_tasks: automatic-upgrades.yaml

# - name: Setup iGPU passthrough
#   ansible.builtin.include_tasks: proxmox-igpu-passthrough.yaml

# - name: Install & Authenticate tailscale
#   ansible.builtin.include_tasks: tailscale.yaml

# - name: CPU, ZFS optimizations
#   ansible.builtin.include_tasks: optimizations.yaml

# - name: Update initramfs
#   ansible.builtin.command: 
#     cmd: update-initramfs -u -k all

# - name: Run update-grub
#   ansible.builtin.command: 
#     cmd: update-grub
#   when: zfs | default(true) | bool == false

# - name: Run proxmox-boot-tool (only on systems running systemd-boot, default with zfs)
#   ansible.builtin.command: 
#     cmd: proxmox-boot-tool refresh
#   when: zfs

# - name: Reboot
#   ansible.builtin.reboot:
#     reboot_timeout: 60
#   ignore_errors: true

# - name: Wait 20 seconds to make sure proxmox API is running for potential other playbooks
#   ansible.builtin.pause:
#     seconds: 20